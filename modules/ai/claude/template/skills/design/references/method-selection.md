# Design Method Selection Guide

設計手法の選択基準と判断フロー。

## 判断フロー

```
ユーザーの要件
    |
    v
┌─────────────────────────────┐
│ 主な関心事は何か？          │
└─────────────────────────────┘
    |
    +-- データの変換・加工 → データフロー設計
    |
    +-- 状態・振る舞い → ステートマシン設計
    |
    +-- 両方 → 複合設計
```

## データフロー設計が適している場合

### 特徴
- 「入力 → 処理 → 出力」の流れが明確
- データの変換・加工が中心的な関心事
- 副作用の少ない純粋な変換処理

### 適用例

#### API連携・ETL処理
- APIレスポンスを加工してデータベースに保存
- CSVファイルを読み込んでJSONに変換
- 複数のデータソースをマージ

#### パイプライン処理
- リアルタイムログ処理
- 画像・動画の変換処理
- データ集計・レポート生成

#### 関数型プログラミング
- map/filter/reduce の組み合わせ
- 関数合成によるデータ変換
- イミュータブルなデータ処理

### キーワード
- 変換、フィルタリング、集計、マッピング
- パイプライン、ストリーム
- ETL、データフロー
- 関数型、純粋関数

## ステートマシン設計が適している場合

### 特徴
- 「状態 → イベント → 次の状態」の関係が重要
- システムの振る舞いや状態管理が中心的な関心事
- イベント駆動の処理

### 適用例

#### ユーザーフロー・UI状態管理
- 認証フロー（未認証 → 認証中 → 認証済み）
- フォームの入力状態管理
- モーダルやウィザードの状態遷移

#### ワークフロー・プロトコル
- 注文処理（受付 → 処理中 → 発送済み → 完了）
- ファイルアップロード（待機 → アップロード中 → 検証中 → 完了）
- WebSocket接続管理（切断 → 接続中 → 接続済み → エラー）

#### ライフサイクル管理
- アプリケーションの起動・停止
- リソースの初期化・解放
- バッチジョブの状態管理

### キーワード
- 状態、遷移、イベント
- ワークフロー、ライフサイクル
- FSM（有限状態機械）
- UI状態、振る舞い

## 複合設計が必要な場合

### 特徴
- 状態管理とデータ処理の両方が重要
- 状態によって異なるデータフロー処理が必要

### 適用例

#### ファイルアップロード機能
- **状態管理**: 待機 → アップロード中 → 検証中 → 完了
- **データフロー**: ファイル受信 → バリデーション → 変換 → 保存

#### リアルタイムデータ処理パイプライン
- **状態管理**: 接続状態、処理状態の管理
- **データフロー**: データ受信 → フィルタ → 変換 → 配信

#### 非同期ジョブシステム
- **状態管理**: ジョブの状態遷移（待機 → 実行中 → 完了/失敗）
- **データフロー**: 入力データの処理パイプライン

### 設計アプローチ

1. **主要な側面を先に設計**
   - 通常は状態遷移を先に設計（全体構造を把握）

2. **補完的な側面を設計**
   - 各状態や遷移で必要なデータフロー処理を設計

3. **統合と整合性確認**
   - 両方の設計図の対応関係を明確化
   - 矛盾や不整合がないか検証

## 判断が難しい場合

### ユーザーに確認する質問

1. **「データはどのように変化しますか？」**
   - 明確な変換フロー → データフロー設計
   - 状態に応じた処理 → ステートマシン設計

2. **「システムはどのような状態を持ちますか？」**
   - 明確な状態がある → ステートマシン設計
   - 状態がない/単純 → データフロー設計

3. **「主な関心事は何ですか？」**
   - データの正確な変換 → データフロー設計
   - 正しい状態遷移 → ステートマシン設計

### 迷ったら

- **両方試す**: 簡単なスケッチレベルで両方を試し、どちらがフィットするか確認
- **主要な側面から**: 最も重要な側面を先に設計し、必要に応じて補完
- **ユーザーの言葉に注目**: 使用する用語から判断（「変換」「フロー」vs「状態」「遷移」）

## まとめ

| 観点 | データフロー設計 | ステートマシン設計 |
|------|------------------|-------------------|
| 焦点 | データの変換 | 状態の遷移 |
| 適用例 | ETL、パイプライン | ワークフロー、UI状態 |
| 図の形式 | フローチャート | 状態遷移図 |
| キーワード | 入力・処理・出力 | 状態・イベント・遷移 |
| 設計成果物 | フロー図 + 変換表 | 遷移図 + 遷移表 |
